services:

  app:
    build: .
    environment:
      OTEL_SERVICE_NAME: "bookapp"
      OTEL_EXPORTER_OTLP_PROTOCOL: grpc
      OTEL_EXPORTER_OTLP_ENDPOINT: http://telemetry:4317
      TRACE_SAMPLE_PROBABILITY: 1.0
    ports:
      - 8000:8000


  backend:
    build: .
    environment:
      OTEL_SERVICE_NAME: "backend"
      OTEL_EXPORTER_OTLP_PROTOCOL: grpc
      OTEL_EXPORTER_OTLP_ENDPOINT: http://telemetry:4317
      TRACE_SAMPLE_PROBABILITY: 1.0
    ports:
      - 8001:8000

  telemetry:
    image: grafana/otel-lgtm:0.6.0
    ports:
      - 4317:4317
      - 4318:4318
      # Grafana UI - admin/admin
      - 3000:3000

